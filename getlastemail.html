<script src="thai.js"></script>
<link rel="stylesheet" href="normmain.css">
<h1>Get Last Email</h1>
<p>Zero damn purpose</p>
<title>Get Last Email of me, please.</title>
<label for="pwd">Password:</label>
<input type="password" id="pwd" name="pwd">
<button id="get">Get it</button>
<pre id="content"></pre>
<script>
    const WORKER_URL = "https://gleworker.alvin9435xd-8db.workers.dev/?";

    function setText(str) {
        document.getElementById("content").textContent = str;
    }

    function fixTheBase64(binary) {
        const bytes = new Uint8Array(binary.length);

        for (let i = 0; i < binary.length; i++) {
            bytes[i] = binary.charCodeAt(i);
        }
        return new TextDecoder("utf-8").decode(bytes);
    }

    async function getData(key) {
        let resp = await fetch(WORKER_URL + new URLSearchParams({
            pw: key
        }).toString())

        if(!resp.ok) {
            setText("Error. Status: " + resp.status + ". Your password is surely wrong.");
            return;
        }

        let txt = await resp.text();

        setText(fixTheBase64(atob(atob(txt))));
    }

    document.getElementById("get").onclick = () => {
        (async() => getData(document.getElementById("pwd").value))();
    }
</script>